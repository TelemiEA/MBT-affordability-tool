<!DOCTYPE html>
<html>
<head>
    <title>Test Grouping</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .group { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .group h3 { margin: 0 0 10px 0; color: #333; background: #f5f5f5; padding: 10px; border-radius: 3px; }
        .scenario { padding: 8px; margin: 5px 0; background: #f9f9f9; border-left: 3px solid #007cba; }
        .debug { background: #ffffcc; padding: 10px; margin: 10px 0; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>Grouping Test</h1>
    <button onclick="testGrouping()">Test Grouping Function</button>
    <div id="output"></div>

    <script>
        async function testGrouping() {
            const output = document.getElementById('output');
            output.innerHTML = '<div class="debug">Testing...</div>';
            
            try {
                // Load the data from the API
                const response = await fetch('http://127.0.0.1:8001/api/latest-results');
                const data = await response.json();
                
                console.log('API Response:', data);
                
                let html = '<div class="debug">API Response received</div>';
                
                // Check if we have grouped results
                if (data.grouped_results && data.group_headers) {
                    html += '<div class="debug">✅ Grouped results found!</div>';
                    
                    const groupOrder = ['sole_employed', 'sole_self_employed', 'joint_employed', 'joint_self_employed'];
                    
                    groupOrder.forEach(groupKey => {
                        const groupData = data.grouped_results[groupKey];
                        const groupHeader = data.group_headers[groupKey];
                        
                        if (groupData && Object.keys(groupData).length > 0) {
                            html += `<div class="group">`;
                            html += `<h3>${groupHeader} (${Object.keys(groupData).length} scenarios)</h3>`;
                            
                            Object.entries(groupData).forEach(([scenarioId, scenarioData]) => {
                                html += `<div class="scenario">${scenarioData.description || scenarioId}</div>`;
                            });
                            
                            html += `</div>`;
                        }
                    });
                } else {
                    html += '<div class="debug">❌ No grouped results found</div>';
                    html += `<div class="debug">Available keys: ${Object.keys(data).join(', ')}</div>`;
                    
                    // Show raw results
                    if (data.results) {
                        html += '<div class="group"><h3>Raw Results (Ungrouped)</h3>';
                        Object.entries(data.results).forEach(([scenarioId, scenarioData]) => {
                            html += `<div class="scenario">${scenarioData.description || scenarioId}</div>`;
                        });
                        html += '</div>';
                    }
                }
                
                output.innerHTML = html;
                
            } catch (error) {
                output.innerHTML = `<div class="debug">❌ Error: ${error.message}</div>`;
                console.error('Error:', error);
            }
        }
    </script>
</body>
</html>